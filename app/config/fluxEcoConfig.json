{
  "$schema": "../schema/flux-eco-learnplaces-backend-schema.json",
  "endpoints": {
    "http": {
      "server": {
        "port": "${SERVER_PORT}",
        "host": "${SERVER_HOST}"
      },
      "policies": {
        "authenticatedUsersOnly": {
          "path": "/test",
          "allowedHeaders": "${SERVER_REQUIRED_HEADERS}",
          "allowedIps": "${SERVER_ALLOWED_IPS}"
        }
      },
      "staticFiles": {
        "path": "/public"
      },
      "actions": {
        "getRepositoryTree": {
          "name": "getRepositoryTree",
          "method": "GET",
          "path": "/getRepositoryTree"
        }
      }
    }
  },
  "bindings": {
    "iliasDatabase": {
      "server": {
        "port": "${DATABASE_PORT}",
        "host": "${DATABASE_HOST}",
        "database": "${DATABASE_DATABASE}",
        "password": "${DATABASE_PASSWORD}",
        "user": "${DATABASE_USER}"
      },
      "boundActions": {
        "getRepositoryTree": {
          "actionName": "queryMysqlDataSource",
          "actionParameters": {
            "tableName": "object_data",
            "joins": [
              {
                "tableName": "object_reference",
                "type": "INNER JOIN",
                "condition": {
                  "leftTableField": "object_data.obj_id",
                  "operator": "=",
                  "rightTableField": "object_reference.obj_id"
                }
              },
              {
                "tableName": "tree",
                "type": "INNER JOIN",
                "condition": {
                  "leftTableField": "object_reference.ref_id",
                  "operator": "=",
                  "rightTableField": "tree.child"
                }
              }
            ],
            "queryOptions": {
              "responseTemplate": {
                "parent": "parent_id",
                "id": "obj_id",
                "data": {
                    "label": "title"
                }
              }
            }
          }
        }
      }
    }
  }
}